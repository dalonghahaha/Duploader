function DuploaderBootstrap(t){this.build_modal(t.id),this.success_callback=t.success_callback,$("#"+t.id).click(function(){this.modal.modal({keyboard:!1}),$("#upload_err").text("").hide()}.bind(this)),this.uploader=new Duploader({debug:!1,chunk:!0,size_limited:524288,btn_add:"file_select_"+t.id,btn_upload:"file_upload_"+t.id,multiple:"multiple"==$("#"+t.id).attr("upload-type"),on_file_add:this.on_file_add.bind(this),on_file_uploading:this.on_file_uploading.bind(this),on_file_slice_finish:this.on_file_slice_finish.bind(this),on_file_list_upload_finish:this.on_file_list_upload_finish.bind(this),on_error:this.on_error.bind(this),upload_url:t.upload_url,upload_type:t.upload_type})}DuploaderBootstrap.prototype.on_error=function(t){$("#upload_err").text(t).show()},DuploaderBootstrap.prototype.build_modal=function(t){var i=$("<div>").addClass("modal fade").attr("id","modal_"+t).attr("tabindex","-1").attr("role","dialog"),a=$("<div>").addClass("modal-dialog").attr("role","document"),e=$("<div>").addClass("modal-content"),d=$("<div>").addClass("modal-header"),l=$("<button>").addClass("close").attr("type","button").attr("data-dismiss","modal").attr("aria-label","Close").html('<span aria-hidden="true">&times;</span>'),s=$("<h4>").addClass("modal-title").text("已选择文件"),o=$("<h5>").addClass("modal-title text-danger").attr("id","upload_err").css({display:"none"}).text(""),n=$("<div>").addClass("modal-body").attr("id","file_list_"+t),r=$("<div>").addClass("modal-footer"),p=$("<button>").addClass("btn btn-primary").attr("type","button").attr("id","file_select_"+t).text("选择"),_=$("<button>").addClass("btn btn-info").attr("type","button").css({"margin-left":"10px"}).attr("id","file_upload_"+t).text("上传");d.append(l).append(s).append(o),r.append(p).append(_),e.append(d).append(n).append(r),i.append(a.append(e)),$("#"+t).after(i),this.modal=$("#modal_"+t),this.section_file_list=$("#file_list_"+t)},DuploaderBootstrap.prototype.on_file_add=function(t,i){var a=$("<button>").addClass("btn btn-sm").attr("id","file_info_"+i.id).text(i.name),e=$("<button>").addClass("btn btn-success btn-sm").text("修改").attr("file_id",i.id).attr("id","file_change_"+i.id).css("margin-left","10px"),d=$("<button>").addClass("btn btn-danger btn-sm").text("删除").attr("file_id",i.id).attr("id","file_delete_"+i.id).css("margin-left","10px"),l=$("<div>").addClass("progress").css("margin-top","10px").attr("id","file_progress_"+i.id).hide(),s=$("<div>").addClass("progress-bar").css("width","0").attr("role","progressbar").attr("id","file_progressbar_"+i.id).attr("aria-valuemin","0").attr("aria-valuemax","100");if(t.config.multiple){var o=$("<div>").attr("id","file_section_"+i.id).append(a).append(e).append(d).append(l.append(s));this.section_file_list.append(o),$("#file_change_"+i.id).on("click",t.file_change.bind(t)),$("#file_delete_"+i.id).on("click",t.file_remove.bind(t))}else{var n=$("span[id*='file_info_']").get(0);if(n){var r=$("span[id*='file_info_']").eq(0).attr("id");i.id=r.substr(r.lastIndexOf("_")+1)}else{var o=$("<p>").attr("id","file_section_"+i.id).append(a).append(l.append(s));if(this.section_file_list.append(o),i.begin_index&&i.begin_index>0){console.log(111);var p=Math.ceil(i.size/t.config.chunk_size),_=0>=p?"0%":Math.round(i.begin_index/p*1e4)/100+"%";$("#file_progressbar_"+i.id).css("width",_),$("#file_progress_"+i.id).show()}}}},DuploaderBootstrap.prototype.on_file_uploading=function(t,i){$("#file_progress_"+i.id).show()},DuploaderBootstrap.prototype.on_file_slice_finish=function(t,i){var a=t.runtime.file_list[i.file_index],e=parseFloat(i.index+1),d=parseFloat(i.total);if(isNaN(e)||isNaN(d))return"-";var l=0>=d?"0%":Math.round(e/d*1e4)/100+"%";$("#file_progressbar_"+a.id).css("width",l)},DuploaderBootstrap.prototype.on_file_list_upload_finish=function(t){this.success_callback(t),this.modal.modal("hide")};